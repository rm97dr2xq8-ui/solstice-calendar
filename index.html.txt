<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>13-Month Solstice Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
body {
  font-family: system-ui, -apple-system, sans-serif;
  margin: 0;
  padding: 1rem;
  background: #f6f6f6;
}
h1 {
  text-align: center;
}
.controls {
  text-align: center;
  margin-bottom: 0.5rem;
}
select {
  font-size: 1rem;
  padding: 0.3rem;
}
.weekdays, .calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  text-align: center;
}
.weekdays div {
  font-weight: bold;
  padding: 0.3rem 0;
}
.calendar {
  gap: 4px;
}
.day {
  background: white;
  border-radius: 6px;
  padding: 6px;
  min-height: 80px;
  cursor: pointer;
}
.num {
  font-size: 1.2rem;
  font-weight: bold;
}
.greg {
  font-size: 0.75rem;
  color: #666;
}
.note {
  font-size: 0.75rem;
}
.footer {
  text-align: center;
  margin-top: 0.8rem;
  font-style: italic;
}
.legend {
  text-align: center;
  font-size: 0.8rem;
  margin-top: 0.5rem;
}
</style>
</head>

<body>

<h1>13-Month Solstice Calendar</h1>

<div class="controls">
  Year:
  <select id="yearSelect"></select>
  Month:
  <select id="monthSelect"></select>
</div>

<div class="weekdays">
  <div>Lunae</div><div>Mars</div><div>Mercur</div>
  <div>Jupiter</div><div>Venus</div><div>Saturn</div><div>Sol</div>
</div>

<div class="calendar" id="calendar"></div>

<div class="legend">
 New 路  Waxing 路  First 路  Waxing Gibbous 路  Full 路  Waning 路  Last 路  Waning
</div>

<div class="footer" id="feriae"></div>

<script>
/* ==========================
   CALENDAR CONSTANTS
========================== */

const WEEKDAYS = ["Lunae", "Mars", "Mercur", "Jupiter", "Venus", "Saturn", "Sol"];

const MONTHS = [
  "Gerar", "Furar", "Mrior", "Prier", "Florar", "Cirear",
  "Cuptora", "Cuptor", "Gustar", "Rpciune",
  "Brumrel", "Brumar", "Ghear"
];

const DAYS_IN_MONTH = 28;

/* ==========================
   ASTRONOMICAL ANCHOR
========================== */

// Winter Solstice 2025 (UTC-based civil approximation)
const ANCHOR_DATE = new Date(Date.UTC(2025, 11, 21)); // Dec 21, 2025
const ANCHOR_YEAR = 2025;

/* ==========================
   EQUINOX / SOLSTICE MARKERS
========================== */

function getSeasonalMarkers(year) {
  return {
    "Winter Solstice": new Date(Date.UTC(year, 11, 21)),
    "Spring Equinox": new Date(Date.UTC(year, 2, 20)),
    "Summer Solstice": new Date(Date.UTC(year, 5, 21)),
    "Autumn Equinox": new Date(Date.UTC(year, 8, 22))
  };
}

/* ==========================
   LEAP YEAR RULE
========================== */

function isLeapYear(year) {
  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
}

/* ==========================
   DATE HELPERS
========================== */

function daysBetween(d1, d2) {
  const ms = 24 * 60 * 60 * 1000;
  return Math.floor((d2 - d1) / ms);
}

function formatGregorian(date) {
  return date.toISOString().split("T")[0];
}

/* ==========================
   CALENDAR GENERATION
========================== */

function generateCalendar(targetYear) {
  const container = document.getElementById("calendar");
  container.innerHTML = "";

  const yearOffset = targetYear - ANCHOR_YEAR;
  const startDate = new Date(ANCHOR_DATE);
  startDate.setUTCDate(startDate.getUTCDate() + yearOffset * 365);

  let currentDate = new Date(startDate);
  const markers = getSeasonalMarkers(targetYear);

  MONTHS.forEach(month => {
    const monthDiv = document.createElement("div");
    monthDiv.className = "month";

    const title = document.createElement("h2");
    title.textContent = month;
    monthDiv.appendChild(title);

    const grid = document.createElement("div");
    grid.className = "grid";

    WEEKDAYS.forEach(w => {
      const h = document.createElement("div");
      h.className = "header";
      h.textContent = w;
      grid.appendChild(h);
    });

    for (let day = 1; day <= DAYS_IN_MONTH; day++) {
      const cell = document.createElement("div");
      cell.className = "day";

      const weekday = WEEKDAYS[(day - 1) % 7];
      const gregorian = formatGregorian(currentDate);

      let note = "";
      for (const [name, date] of Object.entries(markers)) {
        if (formatGregorian(date) === gregorian) {
          note = name;
        }
      }

      cell.innerHTML = `
        <strong>${day}</strong><br>
        <small>${weekday}</small><br>
        <small>${gregorian}</small>
        ${note ? `<div class="note">${note}</div>` : ""}
      `;

      grid.appendChild(cell);
      currentDate.setUTCDate(currentDate.getUTCDate() + 1);
    }

    monthDiv.appendChild(grid);
    container.appendChild(monthDiv);
  });

  /* ==========================
     FERIAE (OUTSIDE TIME)
  ========================= */

  const feriaeDiv = document.createElement("div");
  feriaeDiv.className = "feriae";

  const feriaeTitle = document.createElement("h2");
  feriaeTitle.textContent = "Feriae";
  feriaeDiv.appendChild(feriaeTitle);

  const feriaeCount = isLeapYear(targetYear) ? 2 : 1;

  for (let i = 1; i <= feriaeCount; i++) {
    const d = document.createElement("div");
    d.className = "feriae-day";
    d.innerHTML = `
      <strong>Feriae ${i}</strong><br>
      <small>${formatGregorian(currentDate)}</small>
    `;
    feriaeDiv.appendChild(d);
    currentDate.setUTCDate(currentDate.getUTCDate() + 1);
  }

  container.appendChild(feriaeDiv);
}

/* ==========================
   INITIAL LOAD
========================== */

generateCalendar(2025);
</script>

</body>
</html>
